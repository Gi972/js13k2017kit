<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Game Zero ES6</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:absolute;top:0;bottom:0;left:0;right:0;width:100%;height:100%;image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
var GAME=function(){function e(e,t){var n=e,r=[];this.init=function(){for(var e=0;n>e;e++){var i=new t;i.init(),r[e]=i}},this.get=function(e){if(!r[n-1].inUse)return r[n-1].spawn(e),r.unshift(r.pop()),r[n-1]},this.getPool=function(){return r},this.use=function(){for(var e=0;n>e&&r[e].inUse;e++)r[e].use(v.dt)&&(r[e].clear(),r.push(r.splice(e,1)[0]))}}function t(){this.inUse=!1,this.init=function(){this.x=-500,this.y=-500,this.dead=!0,this.xvel=0,this.yvel=1,this.life=1},t.prototype.spawn=function(e){this.x=e.x,this.y=e.y,this.xvel=e.xvel,this.yvel=e.yvel,this.inUse=!0,this.life=e.life||1,this.remaining=e.life||1,this.radius=e.radius||1,this.color=e.color||v.WHITE,this.dead=!1},t.prototype.use=function(e){return!!this.dead||(this.remaining-=v.dt,this.x+=v.dt*this.xvel,this.y+=v.dt*this.yvel,this.draw(),this.remaining>0?(0>this.y&&(this.dead=!0),!1):(this.dead=!0,!0))},t.prototype.clear=function(){this.x=-500,this.y=-500,this.dead=!0,this.xvel=0,this.yvel=0,this.life=1,this.inUse=!1},t.prototype.draw=function(){v.gfx.circle(this.x,this.y,0|4*Math.random(),21)}}function n(e){return Math.sin(6.283184*e)}function r(e){return 0>n(e)?-1:1}function i(e){return e%1-.5}function a(e){var t=e%1*4;return 2>t?t-1:3-t}function o(e){return.00390625*Math.pow(1.059463094,e-128)}function s(e,t){setTimeout(function(){var n=new Uint8Array(e*l*2),r=n.length-2,i=function(){for(var e=new Date,a=0;r>=0;)if(n[r]=0,n[r+1]=128,r-=2,(a+=1)%1e3==0&&new Date-e>h)return void setTimeout(i,0);setTimeout(function(){t(n)},0)};setTimeout(i,0)},0)}function c(e,t,n,r,i){var a=n.fx_delay_time*r>>1,o=n.fx_delay_amt/255,s=0,c=function(){for(var n=new Date,r=0;t-a>s;){var f=4*s,u=4*(s+a),l=e[u]+(e[u+1]<<8)+(e[f+2]+(e[f+3]<<8)-32768)*o;if(e[u]=255&l,e[u+1]=l>>8&255,l=e[u+2]+(e[u+3]<<8)+(e[f]+(e[f+1]<<8)-32768)*o,e[u+2]=255&l,e[u+3]=l>>8&255,++s,(r+=1)%1e3==0&&new Date-n>h)return void setTimeout(c,0)}setTimeout(i,0)};setTimeout(c,0)}var f={};ENGINE={E:this,screen:0,page1:65536,page2:131072,page3:196608,page4:262144,page5:327680,page6:393216,page7:458752,colors:[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],palDefault:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],pal:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],renderTarget:0,renderSource:65536,currentState:0,playSound:function(e,t,n,r){var i=d.createBufferSource(),a=d.createGain(),o=d.createStereoPanner();return i.buffer=e,i.connect(o),o.connect(a),a.connect(d.destination),i.playbackRate.value=t,i.loop=r,a.gain.value=1,o.pan.value=n,i.start(),{volume:a,sound:i}},gfx:{clear(e){v.ram.fill(e,v.renderTarget,v.renderTarget+65536)},pset(e,t,n){t|=0,(e|=0)>-1&&256>e&&t>-1&&256>t&&(v.ram[v.renderTarget+(256*t+e)]=n)},line(e,t,n,r,i){var a,o,s=(r|=0)-(t|=0),c=(n|=0)-(e|=0);if(0>s?(s=-s,o=-1):o=1,0>c?(c=-c,a=-1):a=1,s<<=1,c<<=1,this.pset(e,t,i),c>s)for(var f=s-(c>>1);e!=n;)0>f||(t+=o,f-=c),e+=a,f+=s,this.pset(e,t,i);else for(f=c-(s>>1);t!=r;)0>f||(e+=a,f-=s),t+=o,f+=c,this.pset(e,t,i)},circle(e,t,n,r){var i=-n,a=0,o=2-2*n;do{this.pset(e-i,t+a,r),this.pset(e-a,t-i,r),this.pset(e+i,t-a,r),this.pset(e+a,t+i,r),(n=o)>a||(o+=2*++a+1),(n>i||o>a)&&(o+=2*++i+1)}while(0>i)},fillCircle(e,t,n,r){e|=0,t|=0,r|=0;var i=-(n|=0),a=0,o=2-2*n;do{this.line(e-i,t-a,e+i,t-a,r),this.line(e-i,t+a,e+i,t+a,r),(n=o)>a||(o+=2*++a+1),(n>i||o>a)&&(o+=2*++i+1)}while(0>i)},rect(e,t,n,r,i){x1=0|e,y1=0|t,x2=e+n|0,y2=t+r|0,this.line(x1,y1,x2,y1,i),this.line(x2,y1,x2,y2,i),this.line(x1,y2,x2,y2,i),this.line(x1,y1,x1,y2,i)},fr(e,t,n,r,i){x1=0|e,y1=0|t,x2=e+n|0,y2=t+r|0;var a=Math.abs(y2-y1);if(v.gfx.line(x1,y1,x2,y1,i),a>0)for(;--a;)v.gfx.line(x1,y1+a,x2,y1+a,i);v.gfx.line(x1,y2,x2,y2,i)},triangle(e,t,n,r,i,a,o){v.gfx.line(e,t,n,r,o),v.gfx.line(n,r,i,a,o),v.gfx.line(i,a,e,t,o)},fillTriangle(e,t,n,r,i,a,o){var e=Math.round(16*e),n=Math.round(16*n),i=Math.round(16*i),t=Math.round(16*t),s=e-n,c=(r=Math.round(16*r))-t,f=n-i,u=(a=Math.round(16*a))-r,l=i-e,h=t-a,d=Math.max(Math.min(e,n,i)+15>>4,0),g=Math.min(Math.max(e,n,i)+15>>4,256),p=Math.max(Math.min(t,r,a)+15>>4,0),y=Math.min(Math.max(t,r,a)+15>>4,256);d&=-8,p&=-8;var x=-c*e-s*t,m=-u*n-f*r,w=-h*i-l*a;(c>0||0==c&&s>0)&&x++,(u>0||0==u&&f>0)&&m++,(h>0||0==h&&l>0)&&w++,x=x-1>>4,m=m-1>>4,w=w-1>>4;var _=0,S=0,T=0,M=0,A=0,D=0;0>s?_-=7*s:S-=7*s,0>c?_-=7*c:S-=7*c,0>f?T-=7*f:M-=7*f,0>u?T-=7*u:M-=7*u,0>l?A-=7*l:D-=7*l,0>h?A-=7*h:D-=7*h;for(var b=p;y>b;b+=8)for(var G=d;g>G;G+=8){var K=x+s*b+c*G,C=m+f*b+u*G,E=w+l*b+h*G;if(!(S>K||M>C||D>E)){var k=G+256*b;if(K<_||C<T||E<A)for(B=0;8>B;B++){for(var q=K,z=C,I=E,L=0;8>L;L++)0>(q|z|I)||(v.ram[v.renderTarget+k]=o),q+=c,z+=u,I+=h,k++;K+=s,C+=f,E+=l,k+=248}else for(var B=0;8>B;B++){for(L=0;8>L;L++,k++)v.ram[v.renderTarget+k]=o;k+=248}}}},spr(e=0,t=0,n=16,r=16,i=0,a=0,o=!1,s=!1){for(var c=0;r>c;c++)for(var f=0;n>f;f++)255>a+c&&255>i+f&&a+c>-1&&i+f>-1&&(o&s?v.ram[v.renderSource+(256*(t+(r-c))+e+(n-f))]>0&&(v.ram[v.renderTarget+(256*(a+c)+i+f)]=v.pal[v.ram[v.renderSource+(256*(t+(r-c))+e+(n-f))]]):s&&!o?v.ram[v.renderSource+(256*(t+(r-c))+e+f)]>0&&(v.ram[v.renderTarget+(256*(a+c)+i+f)]=v.ram[v.renderSource+(256*(t+(r-c))+e+f)]):o&&!s?v.ram[v.renderSource+(256*(t+c)+e+(n-f))]>0&&(v.ram[v.renderTarget+(256*(a+c)+i+f)]=v.ram[v.renderSource+(256*(t+c)+e+(n-f))]):o||s||v.ram[v.renderSource+(256*(t+c)+e+f)]>0&&(v.ram[v.renderTarget+(256*(a+c)+i+f)]=v.pal[v.ram[v.renderSource+(256*(t+c)+e+f)]]))},sspr(e=0,t=0,n=16,r=16,i=0,a=0,o=16,s=16,c=!1,f=!1){for(var u=n/o,l=r/s,h=0;s>h;h++)for(var d=0;o>d;d++)px=d*u|0,py=h*l|0,255>a+h&&255>i+d&&a+h>-1&&i+d>-1&&v.ram[v.renderSource+(256*(t+py)+e+px)]>0&&(v.ram[v.renderTarget+(256*(a+h)+i+d)]=v.ram[v.renderSource+(256*(t+py)+e+px)])},rspr(e,t,n,r,i,a,o,s){s*=.0174533;var c=e+n/2,f=t+r/2,u=n*o/2*1.41421356237|5,l=r*o/2*1.41421356237|5,h=-u,d=u,g=-l,p=l,y=1/o,x=Math.cos(-s)*y,m=Math.sin(-s)*y;for(let e=g;p>e;e++)for(let t=h;d>t;t++){let o=c+Math.round(x*t+m*e),s=f+Math.round(-m*t+x*e),u=t+i|0,l=e+a|0;o>=0&&s>=0&&n>o&&r>s&&v.ram[v.renderSource+(256*s+o)]>0&&(v.ram[v.renderTarget+(256*l+u)]=v.ram[v.renderSource+(256*s+o)])}},checker(e,t,n,r,i){var a=0,o=0;n=n||8,e/=r=r||8,t/=n;for(var s=0;n>s;++s)for(var c=0,f=r/2;f>c;++c)a=2*c*e+(s%2?0:e),o=s*t,v.gfx.fr(a,o,e-1,t-1,i)}},canvasInit:function(){v.C=document.getElementById("canvas"),v.ctx=canvas.getContext("2d"),v.C.width=window.innerWidth,v.C.height=window.innerHeight,v.ctx.imageSmoothingEnabled=!1,v.ctx.mozImageSmoothingEnabled=!1,v.sc=document.createElement("canvas"),v.smallctx=v.sc.getContext("2d"),v.sc.width=256,v.sc.height=256,v.canvasHeight=v.sc.height,v.canvasWidth=v.sc.width,v.imageData=v.smallctx.getImageData(0,0,v.canvasWidth,v.canvasHeight),v.buf=new ArrayBuffer(v.imageData.data.length),v.buf8=new Uint8Array(v.buf),v.data=new Uint32Array(v.buf),v.ram=new Uint8ClampedArray(524288),v.renderTarget=v.screen},render:function(){for(var e=65536;e--;)v.data[e]=v.colors[v.pal[v.ram[e]]];v.imageData.data.set(v.buf8),v.smallctx.putImageData(v.imageData,0,0),v.compositeSize=window.innerWidth<window.innerHeight?window.innerWidth:window.innerHeight,v.compositeOrigin=(window.innerWidth-v.compositeSize)/2|0,v.ctx.imageSmoothingEnabled=!1,v.ctx.mozImageSmoothingEnabled=!1,v.ctx.drawImage(v.sc,0,0,255,255,v.compositeOrigin,0,v.compositeSize,v.compositeSize)}},(v=ENGINE).assets={sounds:{laserOne:{osc1_oct:6,osc1_det:0,osc1_detune:0,osc1_xenv:1,osc1_vol:192,osc1_waveform:3,osc2_oct:8,osc2_det:0,osc2_detune:0,osc2_xenv:1,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:0,env_sustain:0,env_release:7916,env_master:99,fx_filter:0,fx_freq:11025,fx_resonance:255,fx_delay_time:0,fx_delay_amt:0,fx_pan_freq:0,fx_pan_amt:0,lfo_osc1_freq:0,lfo_fx_freq:0,lfo_freq:4,lfo_amt:27,lfo_waveform:1}},song:{rowLen:5513,endPattern:2,songData:[{osc1_oct:7,osc1_det:0,osc1_detune:0,osc1_xenv:0,osc1_vol:192,osc1_waveform:1,osc2_oct:6,osc2_det:0,osc2_detune:9,osc2_xenv:0,osc2_vol:192,osc2_waveform:1,noise_fader:0,env_attack:137,env_sustain:2e3,env_release:4611,env_master:192,fx_filter:1,fx_freq:982,fx_resonance:89,fx_delay_time:6,fx_delay_amt:25,fx_pan_freq:6,fx_pan_amt:77,lfo_osc1_freq:0,lfo_fx_freq:1,lfo_freq:3,lfo_amt:69,lfo_waveform:0,p:[1],c:[{n:[135,0,0,0,147,0,0,145,0,0,147,0,0,142,0,0,135,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]}]}],songLen:9},letters:{"-":[[,,,,0],[,,,,0],[1,1,1,1,1],[,,,,0],[,,,,0]],".":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,1,,0]],1:[[,1,1,,0],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],2:[[1,1,1,1,0],[,,,,1],[,1,1,1,0],[1,,,,0],[1,1,1,1,1]],3:[[1,1,1,1,0],[,,,,1],[,1,1,1,1],[,,,,1],[1,1,1,1,0]],4:[[1,,,1,0],[1,,,1,0],[1,1,1,1,1],[,,,1,0],[,,,1,0]],5:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,0],[,,,,1],[1,1,1,1,0]],6:[[,1,1,1,0],[1,,,,0],[1,1,1,1,0],[1,,,,1],[,1,1,1,0]],7:[[1,1,1,1,1],[,,,,1],[,,,1,0],[,,1,,0],[,,1,,0]],8:[[,1,1,1,0],[1,,,,1],[,1,1,1,0],[1,,,,1],[,1,1,1,0]],9:[[,1,1,1,0],[1,,,,1],[,1,1,1,1],[,,,,1],[,1,1,1,0]],0:[[,1,1,1,0],[1,,,,1],[1,,,,1],[1,,,,1],[,1,1,1,0]],A:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],B:[[1,1,1,1,0],[1,,,1,0],[1,1,1,1,1],[1,,,,1],[1,1,1,1,1]],C:[[1,1,1,1,1],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],D:[[1,1,1,,0],[1,,,1,0],[1,,,,1],[1,,,,1],[1,1,1,1,1]],E:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,1,1,1,1]],F:[[1,1,1,1,1],[1,,,,0],[1,1,1,,0],[1,,,,0],[1,,,,0]],G:[[1,1,1,1,1],[1,,,,0],[1,,1,1,1],[1,,,,1],[1,1,1,1,1]],H:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[1,,,,1],[1,,,,1]],I:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[1,1,1,1,1]],J:[[,,,,1],[,,,,1],[,,,,1],[1,,,,1],[1,1,1,1,1]],K:[[1,,,1,0],[1,,1,,0],[1,1,1,,0],[1,,,1,0],[1,,,,1]],L:[[1,,,,0],[1,,,,0],[1,,,,0],[1,,,,0],[1,1,1,1,1]],M:[[1,,,,1],[1,1,,1,1],[1,,1,,1],[1,,,,1],[1,,,,1]],N:[[1,,,,1],[1,1,,,1],[1,,1,,1],[1,,,1,1],[1,,,,1]],O:[[1,1,1,1,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],P:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,,0],[1,,,,0]],Q:[[1,1,1,1,0],[1,,,1,0],[1,,,1,0],[1,,,1,0],[1,1,1,1,1]],R:[[1,1,1,1,1],[1,,,,1],[1,1,1,1,1],[1,,,1,0],[1,,,,1]],S:[[1,1,1,1,1],[1,,,,0],[1,1,1,1,1],[,,,,1],[1,1,1,1,1]],T:[[1,1,1,1,1],[,,1,,0],[,,1,,0],[,,1,,0],[,,1,,0]],U:[[1,,,,1],[1,,,,1],[1,,,,1],[1,,,,1],[1,1,1,1,1]],V:[[1,,,,1],[1,,,,1],[1,,,,1],[,1,,1,0],[,,1,,0]],W:[[1,,,,1],[1,,,,1],[1,,1,,1],[1,1,,1,1],[1,,,,1]],X:[[1,,,,1],[,1,,1,0],[,,1,,0],[,1,,1,0],[1,,,,1]],Y:[[1,,,,1],[1,,,,1],[1,1,1,1,1],[,,1,,0],[,,1,,0]],Z:[[1,1,1,1,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,1,1,1,1]]," ":[[,,,,0],[,,,,0],[,,,,0],[,,,,0],[,,,,0]],",":[[,,,,0],[,,,,0],[,,,,0],[,,1,,0],[,,1,,0]],"+":[[,,,,0],[,,1,,0],[,1,1,1,0],[,,1,,0],[,,,,0]],"/":[[,,,,1],[,,,1,0],[,,1,,0],[,1,,,0],[1,,,,0]],":":[[,,,,0],[,,1,,0],[,,,,0],[,,1,,0],[,,,,0]],"@":[[1,1,1,1,1],[,,,,1],[1,1,1,,1],[1,,1,,1],[1,1,1,1,1]],x:[[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1]],z:[[,1,,1,0],[1,,1,,1],[,1,,1,0],[1,,1,,1],[,1,,1,0]],o:[[1,1,1,1,1],[1,,,,1],[1,,1,,1],[1,,,,1],[1,1,1,1,1]],e:[[1,,,,0],[1,1,,,0],[1,1,1,,0],[1,1,1,1,0],[1,1,1,1,1]],w:[[,,,,1],[,,,1,1],[,,1,1,1],[,1,1,1,1],[1,1,1,1,1]],s:[[1,1,1,1,1],[,1,1,1,1],[,,1,1,1],[,,,1,1],[,,,,1]],d:[[1,1,1,1,1],[1,1,1,1,0],[1,1,1,,0],[1,1,,,0],[1,,,,0]],t:[[0,0,0,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1],[0,0,1,1,1]],y:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]],u:[[1,1,0,0,0],[1,1,1,0,0],[0,0,1,0,0],[0,1,1,0,0],[1,1,1,0,0]],g:[[0,0,1,1,1],[0,0,0,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,1]],h:[[1,1,1,1,1],[1,1,1,1,1],[0,1,1,1,0],[1,1,1,1,1],[1,1,1,1,1]],j:[[1,1,1,0,0],[1,1,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[1,1,1,1,1]],b:[[0,0,0,1,1],[0,0,0,1,1],[0,0,0,0,1],[0,0,0,0,1],[0,0,0,0,1]],n:[[1,1,1,1,1],[1,1,1,1,1],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],a:[[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]]}};var u={},l=2,h=33,d=null,g=[n,r,i,a];u.AudioGenerator=function(e){this.mixBuf=e,this.waveSize=e.length/l/2},u.AudioGenerator.prototype.getWave=function(){var e,t,n,r,i,a,o,s=this.mixBuf,c=this.waveSize*l*2;for(a=(i=c-8)-36,r=String.fromCharCode(82,73,70,70,255&i,i>>8&255,i>>16&255,i>>24&255,87,65,86,69,102,109,116,32,16,0,0,0,1,0,2,0,68,172,0,0,16,177,2,0,4,0,16,0,100,97,116,97,255&a,a>>8&255,a>>16&255,a>>24&255),e=0;c>e;){for(n="",t=0;256>t&&c>e;++t,e+=2)o=-32768>(o=4*(s[e]+(s[e+1]<<8)-32768))?-32768:o>32767?32767:o,n+=String.fromCharCode(255&o,o>>8&255);r+=n}return r},u.AudioGenerator.prototype.getAudio=function(){var e=this.getWave(),t=new Audio("data:audio/wav;base64,"+btoa(e));return t.preload="none",t.load(),t},u.AudioGenerator.prototype.getAudioBuffer=function(e){null===d&&(d=new AudioContext);var t=this.mixBuf,n=this.waveSize*l*2,r=d.createBuffer(l,this.waveSize,44100),i=r.getChannelData(0),a=r.getChannelData(1),o=0,s=function(){for(var c=new Date,f=0;n/2>o;){var u=4*(t[4*o]+(t[4*o+1]<<8)-32768);if(u=-32768>u?-32768:u>32767?32767:u,i[o]=u/32768,u=4*(t[4*o+2]+(t[4*o+3]<<8)-32768),u=-32768>u?-32768:u>32767?32767:u,a[o]=u/32768,o+=1,(f+=1)%1e3==0&&new Date-c>h)return void setTimeout(s,0)}setTimeout(function(){e(r)},0)};setTimeout(s,0)},u.SoundGenerator=function(e,t){this.instr=e,this.rowLen=t||5605,this.osc_lfo=g[e.lfo_waveform],this.osc1=g[e.osc1_waveform],this.osc2=g[e.osc2_waveform],this.attack=e.env_attack,this.sustain=e.env_sustain,this.release=e.env_release,this.panFreq=Math.pow(2,e.fx_pan_freq-8)/this.rowLen,this.lfoFreq=Math.pow(2,e.lfo_freq-8)/this.rowLen},u.SoundGenerator.prototype.genSound=function(e,t,r){new Date;for(var i=0,a=0,s=o(e+12*(this.instr.osc1_oct-8)+this.instr.osc1_det)*(1+8e-4*this.instr.osc1_detune),c=o(e+12*(this.instr.osc2_oct-8)+this.instr.osc2_det)*(1+8e-4*this.instr.osc2_detune),f=this.instr.fx_resonance/255,u=0,l=0,h=this.attack+this.sustain+this.release-1;h>=0;--h){var d=h+r,g=this.osc_lfo(d*this.lfoFreq)*this.instr.lfo_amt/512+.5,v=1;h<this.attack?v=h/this.attack:h<this.attack+this.sustain||(v-=(h-this.attack-this.sustain)/this.release);var p=s;this.instr.lfo_osc1_freq&&(p+=g),this.instr.osc1_xenv&&(p*=v*v),i+=p;var y=this.osc1(i)*this.instr.osc1_vol;p=c,this.instr.osc2_xenv&&(p*=v*v),a+=p,y+=this.osc2(a)*this.instr.osc2_vol,this.instr.noise_fader&&(y+=(2*Math.random()-1)*this.instr.noise_fader*v),y*=v/255;var x=this.instr.fx_freq;this.instr.lfo_fx_freq&&(x*=g);var m=f*(y-l)-(u+=(x=1.5*Math.sin(3.141592*x/44100))*l);switch(l+=x*m,this.instr.fx_filter){case 1:y=m;break;case 2:y=u;break;case 3:y=l;break;case 4:y=u+m}if(p=n(d*this.panFreq)*this.instr.fx_pan_amt/512+.5,y*=39*this.instr.env_master,(d*=4)+3<t.length){var w=t[d]+(t[d+1]<<8)+y*(1-p);t[d]=255&w,t[d+1]=w>>8&255,w=t[d+2]+(t[d+3]<<8)+y*p,t[d+2]=255&w,t[d+3]=w>>8&255}}},u.SoundGenerator.prototype.getAudioGenerator=function(e,t){var n=this.attack+this.sustain+this.release-1+32*this.rowLen,r=this;s(n,function(i){r.genSound(e,i,0),c(i,n,r.instr,r.rowLen,function(){t(new u.AudioGenerator(i))})})},u.SoundGenerator.prototype.createAudio=function(e,t){this.getAudioGenerator(e,function(e){t(e.getAudio())})},u.SoundGenerator.prototype.createAudioBuffer=function(e,t){this.getAudioGenerator(e,function(e){e.getAudioBuffer(t)})},u.MusicGenerator=function(e){this.song=e,this.waveSize=44100*e.songLen},u.MusicGenerator.prototype.generateTrack=function(e,t,n){var r=this;s(this.waveSize,function(i){var a=r.waveSize,o=r.waveSize*l*2,s=r.song.rowLen,f=r.song.endPattern,d=new u.SoundGenerator(e,s),g=0,v=0,p=0,y=function(){for(var t=new Date;;)if(32!==p){if(v===f-1)return void setTimeout(x,0);var n=e.p[v];if(n){var r=e.c[n-1].n[p];r&&d.genSound(r,i,g)}if(g+=s,p+=1,new Date-t>h)return void setTimeout(y,0)}else p=0,v+=1},x=function(){c(i,a,e,s,w)},m=0,w=function(){for(var e=new Date,r=0;o>m;){var a=t[m]+(t[m+1]<<8)+i[m]+(i[m+1]<<8)-32768;if(t[m]=255&a,t[m+1]=a>>8&255,m+=2,(r+=1)%1e3==0&&new Date-e>h)return void setTimeout(w,0)}setTimeout(n,0)};setTimeout(y,0)})},u.MusicGenerator.prototype.getAudioGenerator=function(e){var t=this;s(this.waveSize,function(n){var r=0,i=function(){r<t.song.songData.length?(r+=1,t.generateTrack(t.song.songData[r-1],n,i)):e(new u.AudioGenerator(n))};i()})},u.MusicGenerator.prototype.createAudio=function(e){this.getAudioGenerator(function(t){e(t.getAudio())})},u.MusicGenerator.prototype.createAudioBuffer=function(e){this.getAudioGenerator(function(t){t.getAudioBuffer(e)})},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},Txt={textLine(e){for(var t=e.text.length,n=0;t>n;n++)for(var r=v.assets.letters[e.text.charAt(n)]||v.assets.letters.unknown,i=0;5>i;i++)for(var a=0;5>a;a++)1===r[i][a]&&(1===e.scale?v.gfx.pset(e.x+a*e.scale+(5*e.scale+e.hspacing)*n,e.y+i*e.scale,e.color):v.gfx.fr(e.x+a*e.scale+(5*e.scale+e.hspacing)*n,e.y+i*e.scale,e.scale,e.scale,e.color))},text(e){var t=5*e.scale,n=e.text.split("\n"),r=n.slice(0),i=n.length,a=r.sort(function(e,t){return t.length-e.length})[0],o=a.length*t+(a.length-1)*e.hspacing,s=i*t+(i-1)*e.vspacing;e.halign||(e.halign="left"),e.valign||(e.valign="bottom");var c=e.x,f=e.y,u=e.x+o,l=e.y+s;"center"==e.halign?(c=e.x-o/2,u=e.x+o/2):"right"==e.halign&&(c=e.x-o,u=e.x),"center"==e.valign?(f=e.y-s/2,l=e.y+s/2):"bottom"==e.valign&&(f=e.y-s,l=e.y);var h=c+o/2,d=f+s/2;if(e.render)for(var g=0;i>g;g++){var v=n[g],p=v.length*t+(v.length-1)*e.hspacing,y=e.x,x=e.y+(t+e.vspacing)*g;"center"==e.halign?y=e.x-p/2:"right"==e.halign&&(y=e.x-p),"center"==e.valign?x-=s/2:"bottom"==e.valign&&(x-=s),e.snap&&(y=Math.floor(y),x=Math.floor(x)),this.textLine({ctx:e.ctx,x:y,y:x,text:v,hspacing:e.hspacing||0,scale:e.scale||1,color:e.color})}return{sx:c,sy:f,cx:h,cy:d,ex:u,ey:l,width:o,height:s}}},f.gameover={step:function(e){Key.isDown(Key.r)&&(v.state="menu")},render:function(e){v.gfx.fr(0,0,256,256,0),v.gfx.fr(0,0,64,64,2),Txt.text({x:128,y:40+15*Math.sin(2.5*v.t),text:"GAME\nOVER",hspacing:8+4*Math.cos(2.9*v.t),vspacing:15+5*Math.sin(3.5*v.t),halign:"center",valign:"top",scale:10,snap:1,render:1,color:21})}},f.menu={step:function(e){Key.isDown(Key.p)&&(v.state="game")},render:function(e){v.gfx.fr(0,0,256,256,0),v.gfx.fr(0,0,64,64,2),Txt.text({x:128,y:40+15*Math.sin(2.5*v.t),text:"MENU",hspacing:8+4*Math.cos(2.9*v.t),vspacing:15+5*Math.sin(3.5*v.t),halign:"center",valign:"top",scale:10,snap:1,render:1,color:21})}},f.game={step(e){v.player.update(e),Key.justReleased(Key.z)&&(v.songTrigger=!0),v.songTrigger&&(v.playSound(v.sounds.song,1,1,0),v.songTrigger=!1),bulletPool.use(),Key.update()},render(e){v.renderTarget=0,v.gfx.clear(1),v.player.draw()},renderColorNumbers(){for(var e=0;32>e;e++)Txt.text({x:16>e?3+16*e:3+16*(e-16),y:16>e?45:61,text:""+e,scale:1,snap:1,hspacing:1,vspacing:2,halign:"left",valign:"bottom",render:1,color:e});Txt.text({x:8,y:240,text:"X: "+(""+v.player.x).substring(0,7)+"\nY: "+(""+v.player.y).substring(0,7),hspacing:2,vspacing:2,halign:"left",valign:"top",scale:1,snap:1,render:1,color:21})},renderDrawingAPI(){v.gfx.pset(32,80,21),v.gfx.line(64,80,80,112,21),v.gfx.rect(96,80,16,32,21),v.gfx.circle(128,96,16,21)}},v.player={bullet:{x:0,y:0,xvel:0,yvel:0},init(){this.x=64,this.y=230,this.radius=12,this.xvel=0,this.yvel=0,this.xspeed=400,this.yspeed=400,this.drag=.6},update(e){v.player.bullet.x=v.player.x,v.player.bullet.y=v.player.y,v.player.xvel*=v.player.drag,v.player.yvel*=v.player.drag;let t=e*v.player.xvel,n=e*v.player.yvel;v.player.x+=t,v.player.y+=n,(Key.isDown(Key.d)||Key.isDown(Key.RIGHT))&&(v.player.xvel=v.player.xspeed),(Key.isDown(Key.a)||Key.isDown(Key.LEFT))&&(v.player.xvel=-v.player.xspeed),(Key.isDown(Key.w)||Key.isDown(Key.UP))&&(v.player.yvel=-v.player.yspeed),(Key.isDown(Key.s)||Key.isDown(Key.DOWN))&&(v.player.yvel=v.player.yspeed),Key.isDown(Key.SPACE||Key.isDown(Key.z))&&(v.player.bullet.yvel=-350,bulletPool.get(v.player.bullet)),v.player.x>256&&(v.player.x=0),0>v.player.x&&(v.player.x=256),v.player.y>256&&(v.player.y=0),0>v.player.y&&(v.state="gameover",v.player.y=256)},draw(e){v.gfx.fillCircle(this.x,this.y,this.radius,21)}};var v=ENGINE;init=function(){v.last=0,v.dt=0,v.now=0,v.t=0,v.moveX=0,v.speedFactor=.6,v.songTrigger=!1,v.state="menu",bulletPool=new e(100,t),v.sounds={},v.canvasInit(),v.starColors=[15,16,17,18,19,20,21],bulletPool.init(),v.player.init(),soundInit(),eventInit(),loop()},stopCapture=(e=>{}),loop=(()=>{let e=(new Date).getTime();v.dt=Math.min(1,(e-v.last)/1e3);v.t+=v.dt;f[v.state].render();f[v.state].step(v.dt);v.last=e;v.render();requestAnimationFrame(loop)}),soundInit=(()=>{v.sounds={};d&&d.close();window.AudioContext=window.AudioContext||window.webkitAudioContext;d||(d=new AudioContext);let e=new u.MusicGenerator(v.assets.song);e.createAudioBuffer(function(e){v.sounds.song=e})}),eventInit=(()=>{window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1);window.addEventListener("mousedown",function(e){stopCapture(e)},!1);window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1);window.addEventListener("blur",function(e){paused=!0},!1);window.addEventListener("focus",function(e){paused=!1},!1);window.addEventListener("resize",function(e){v.C.width=window.innerWidth,v.C.height=window.innerHeight})}),window.onload=init()}();
</script></body></html>