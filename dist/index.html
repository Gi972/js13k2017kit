<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13K 2017 boilerplate</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:fixed;top:50%;bottom:0;left:50%;right:0;width:200vmin;height:100vmin;transform:translate(-50%,-25%);image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
!function(){function e(e){S.fill(e,renderTarget,renderTarget+131072)}function n(e,n,t){n|=0,t|=0,(e|=0)>-1&&e<p&&n>-1&&n<y&&(S[renderTarget+(n*p+e)]=t)}function r(e,t,r,a,o){var i,s,c=(a|=0)-(t|=0),d=(r|=0)-(e|=0);if(c<0?(c=-c,s=-1):s=1,d<0?(d=-d,i=-1):i=1,c<<=1,d<<=1,n(e,t,o),d>c)for(var l=c-(d>>1);e!=r;)l>=0&&(t+=s,l-=d),l+=c,n(e+=i,t,o);else for(l=d-(c>>1);t!=a;)l>=0&&(e+=i,l-=c),l+=d,n(e,t+=s,o)}function a(e,t,r,a){var o=-r,i=0,s=2-2*r;do{n(e-o,t+i,a),n(e-i,t-o,a),n(e+o,t-i,a),n(e+i,t+o,a),(r=s)<=i&&(s+=2*++i+1),(r>o||s>i)&&(s+=2*++o+1)}while(o<0)}function o(e,n,t,a){if(!(t<0)){e|=0,n|=0,a|=0;var o=-(t|=0),i=0,s=2-2*t;do{r(e-o,n-i,e+o,n-i,a),r(e-o,n+i,e+o,n+i,a),(t=s)<=i&&(s+=2*++i+1),(t>o||s>i)&&(s+=2*++o+1)}while(o<0)}}function i(e,n,t,a,o){x1=0|e,y1=0|n,x2=e+t|0,y2=n+a|0,r(x1,y1,x2,y1,o),r(x2,y1,x2,y2,o),r(x1,y2,x2,y2,o),r(x1,y1,x1,y2,o)}function s(e,n,t,a,o){x1=0|e,y1=0|n,x2=e+t|0,y2=n+a|0;var i=Math.abs(y2-y1);if(r(x1,y1,x2,y1,o),i>0)for(;--i;)r(x1,y1+i,x2,y1+i,o);r(x1,y2,x2,y2,o)}function c(e,n,t,a,o,i,s){r(e,n,t,a,s),r(t,a,o,i,s),r(o,i,e,n,s)}function d(e,n,t,r,a,o,i){var s=p,e=Math.round(16*e),t=Math.round(16*t),a=Math.round(16*a),n=Math.round(16*n),c=e-t,d=(r=Math.round(16*r))-n,l=t-a,g=(o=Math.round(16*o))-r,u=a-e,f=n-o,h=Math.max(Math.min(e,t,a)+15>>4,0),x=Math.min(Math.max(e,t,a)+15>>4,p),v=Math.max(Math.min(n,r,o)+15>>4,0),m=Math.min(Math.max(n,r,o)+15>>4,y);h&=-8,v&=-8;var M=-d*e-c*n,w=-g*t-l*r,T=-f*a-u*o;(d>0||0==d&&c>0)&&M++,(g>0||0==g&&l>0)&&w++,(f>0||0==f&&u>0)&&T++,M=M-1>>4,w=w-1>>4,T=T-1>>4;var E=0,A=0,C=0,D=0,K=0,L=0;c>=0?A-=7*c:E-=7*c,d>=0?A-=7*d:E-=7*d,l>=0?D-=7*l:C-=7*l,g>=0?D-=7*g:C-=7*g,u>=0?L-=7*u:K-=7*u,f>=0?L-=7*f:K-=7*f;for(var _=s-8,b=v;b<m;b+=8)for(var I=h;I<x;I+=8){var O=M+c*b+d*I,P=w+l*b+g*I,B=T+u*b+f*I;if(!(O<A||P<D||B<L)){var U=I+b*s;if(O>=E&&P>=C&&B>=K)for(k=0;k<8;k++){for(N=0;N<8;N++,U++)S[renderTarget+U]=i;U+=_}else for(var k=0;k<8;k++){for(var R=O,F=P,G=B,N=0;N<8;N++)(R|F|G)>=0&&(S[renderTarget+U]=i),R+=d,F+=g,G+=f,U++;O+=c,P+=l,B+=u,U+=_}}}}function l(e=0,n=0,t=16,r=16,a=0,o=0,i=!1,s=!1){for(var c=0;c<r;c++)for(var d=0;d<t;d++)o+c<y&&a+d<p&&o+c>-1&&a+d>-1&&(i&s?S[renderSource+((n+(r-c))*p+e+(t-d))]>0&&(S[renderTarget+((o+c)*p+a+d)]=pal[S[renderSource+((n+(r-c))*p+e+(t-d))]]):s&&!i?S[renderSource+((n+(r-c))*p+e+d)]>0&&(S[renderTarget+((o+c)*p+a+d)]=S[renderSource+((n+(r-c))*p+e+d)]):i&&!s?S[renderSource+((n+c)*p+e+(t-d))]>0&&(S[renderTarget+((o+c)*p+a+d)]=S[renderSource+((n+c)*p+e+(t-d))]):i||s||S[renderSource+((n+c)*p+e+d)]>0&&(S[renderTarget+((o+c)*p+a+d)]=pal[S[renderSource+((n+c)*p+e+d)]]))}function g(e=0,n=0,t=16,r=16,a=0,o=0,i=16,s=16,c=!1,d=!1){for(var l=t/i,g=r/s,u=0;u<s;u++)for(var f=0;f<i;f++)px=f*l|0,py=u*g|0,o+u<y&&a+f<p&&o+u>-1&&a+f>-1&&S[renderSource+((n+py)*p+e+px)]>0&&(S[renderTarget+((o+u)*p+a+f)]=S[renderSource+((n+py)*p+e+px)])}function u(){for(var e=131072;e--;)T[e]=colors[pal[S[e]]];m.data.set(w),ctx.putImageData(m,0,0)}function f(e){for(var t=e.text.length,r=0;r<t;r++){var a=[];a=x(e.text.charAt(r));for(var o=0;o<5;o++)for(var i=0;i<5;i++)1==a[5*o+i]&&(1==e.scale?n(e.x+i*e.scale+(5*e.scale+e.hspacing)*r,e.y+o*e.scale,e.color):s(e.x+i*e.scale+(5*e.scale+e.hspacing)*r,e.y+o*e.scale,e.scale,e.scale,e.color))}}function h(e){var n=5*e.scale,t=e.text.split("\n"),r=t.slice(0),a=t.length,o=r.sort(function(e,n){return n.length-e.length})[0],i=o.length*n+(o.length-1)*e.hspacing,s=a*n+(a-1)*e.vspacing;e.halign||(e.halign="left"),e.valign||(e.valign="bottom");var c=e.x,d=e.y,l=e.x+i,g=e.y+s;"center"==e.halign?(c=e.x-i/2,l=e.x+i/2):"right"==e.halign&&(c=e.x-i,l=e.x),"center"==e.valign?(d=e.y-s/2,g=e.y+s/2):"bottom"==e.valign&&(d=e.y-s,g=e.y);var u=c+i/2,h=d+s/2;if(e.render)for(var x=0;x<a;x++){var p=t[x],y=p.length*n+(p.length-1)*e.hspacing,v=e.x,m=e.y+(n+e.vspacing)*x;"center"==e.halign?v=e.x-y/2:"right"==e.halign&&(v=e.x-y),"center"==e.valign?m-=s/2:"bottom"==e.valign&&(m-=s),e.snap&&(v=Math.floor(v),m=Math.floor(m)),f({x:v,y:m,text:p,hspacing:e.hspacing||0,scale:e.scale||1,color:e.color})}return{sx:c,sy:d,cx:u,cy:h,ex:l,ey:g,width:i,height:s}}function x(e){return index=fontString.indexOf(e),fontBitmap.substring(25*index,25*index+25).split("")}const p=512,y=256;var v=document.getElementById("canvas");ctx=v.getContext("2d"),renderTarget=0,renderSource=131072,colors=[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],ctx.imageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,v.width=p,v.height=y;var m=ctx.getImageData(0,0,512,256),M=new ArrayBuffer(m.data.length),w=new Uint8Array(M),T=new Uint32Array(M),S=new Uint8ClampedArray(1048576);states={},init=(()=>{last=0;dt=0;now=0;t=0;moveX=0;speedFactor=.6;songTrigger=!1;state="menu";demostate=0;audioCtx=new AudioContext;fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@.'\"?/<()";fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010";sounds={};loop()}),stopCapture=(e=>{}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("mousedown",function(e){stopCapture(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(()=>{let e=(new Date).getTime();dt=Math.min(1,(e-last)/1e3);t+=dt;states[state].render();states[state].step(dt);last=e;u();requestAnimationFrame(loop)}),states.gameover={step:function(e){Key.isDown(Key.r)&&(state="menu")},render:function(n){renderTarget=0,e(0),h({x:256,y:80+15*Math.sin(2.5*t),text:"GAME OVER",hspacing:8+4*Math.cos(2.9*t),vspacing:15+5*Math.sin(3.5*t),halign:"center",valign:"top",scale:9,snap:1,render:1,color:27})}},states.menu={step:function(e){Key.isDown(Key.p)&&(state="game")},render:function(r){renderTarget=0,e(0);let a=t/3;for(let e=-128;e<128;e+=1)for(let t=-256;t<256;t+=2)n(256+t+256*Math.cos(4*(e/128+a))+e,256+e+128*Math.sin(4*(t/256+a))+t,t/8%32);h({x:256,y:40+15*Math.sin(2.5*t),text:"PROTOGAME",hspacing:8+4*Math.cos(2.9*t),vspacing:15+5*Math.sin(3.5*t),halign:"center",valign:"top",scale:9,snap:1,render:1,color:21}),h({x:256,y:230,text:"PRESS P TO CONTINUE",hspacing:2,vspacing:2,halign:"center",valign:"top",scale:1,snap:1,render:1,color:21})}},states.game={step(e){},render(u){renderTarget=0,e(1);let f=t/3;for(let e=-128;e<128;e+=1)for(let t=-256;t<256;t+=2)n(256+t+256*Math.cos(4*(e/128+f))+e,256+e+128*Math.sin(4*(t/256+f))+t,t/8%32);renderTarget=0,s(0,0,16,16,17),i(400,16,16,16),o(32,32,8,21),a(64,32,8,21),r(128,32,192,64,21),c(0,0,16,16,32,32),d(32,0,64,64,128,128,21),l(0,0,16,16),g(0,0,16,16,0,0,16,16),h({x:256,y:20,text:"512X256 DISPLAY  DB32 PALETTE",hspacing:2,vspacing:2,halign:"center",valign:"top",scale:1,snap:1,render:1,color:21})}},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},window.onload=init()}();
</script></body></html>