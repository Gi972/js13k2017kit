<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>JS13K 2017 boilerplate</title><style>
body{margin:0;overflow:hidden;background:#111;color:#ccc}#canvas{position:fixed;top:50%;bottom:0;left:50%;right:0;width:180vmin;height:90vmin;transform:translate(-50%,-25%);image-rendering:optimizeSpeed;image-rendering:-moz-crisp-edges;image-rendering:-webkit-optimize-contrast;image-rendering:-o-crisp-edges;image-rendering:pixelated;-ms-interpolation-mode:nearest-neighbor;cursor:none;margin:auto}
</style></head><body><canvas id="canvas"></canvas><script>
!function(){function e(e){E.fill(e,renderTarget,renderTarget+131072)}function r(e,t,r){t|=0,r|=0,(e|=0)>0&&e<x&&t>0&&t<v&&(E[renderTarget+(t*x+e)]=r)}function n(e,t,n,o,a){var i,d,s=(o|=0)-(t|=0),u=(n|=0)-(e|=0);if(s<0?(s=-s,d=-1):d=1,u<0?(u=-u,i=-1):i=1,s<<=1,u<<=1,r(e,t,a),u>s)for(var c=s-(u>>1);e!=n;)c>=0&&(t+=d,c-=u),c+=s,r(e+=i,t,a);else for(c=u-(s>>1);t!=o;)c>=0&&(e+=i,c-=s),c+=u,r(e,t+=d,a)}function o(e,t,n,o){var a=-n,i=0,d=2-2*n;do{r(e-a,t+i,o),r(e-i,t-a,o),r(e+a,t-i,o),r(e+i,t+a,o),(n=d)<=i&&(d+=2*++i+1),(n>a||d>i)&&(d+=2*++a+1)}while(a<0)}function a(e,t,r,o){if(!(r<0)){e|=0,t|=0,o|=0;var a=-(r|=0),i=0,d=2-2*r;do{n(e-a,t-i,e+a,t-i,o),n(e-a,t+i,e+a,t+i,o),(r=d)<=i&&(d+=2*++i+1),(r>a||d>i)&&(d+=2*++a+1)}while(a<0)}}function i(e,t,r,o,a){x1=0|e,y1=0|t,x2=e+r|0,y2=t+o|0,n(x1,y1,x2,y1,a),n(x2,y1,x2,y2,a),n(x1,y2,x2,y2,a),n(x1,y1,x1,y2,a)}function d(e,t,r,o,a){x1=0|e,y1=0|t,x2=e+r|0,y2=t+o|0;var i=Math.abs(y2-y1);if(n(x1,y1,x2,y1,a),i>0)for(;--i;)n(x1,y1+i,x2,y1+i,a);n(x1,y2,x2,y2,a)}function s(e,t,r,o,a,i,d){n(e,t,r,o,d),n(r,o,a,i,d),n(a,i,e,t,d)}function u(e,t,r,n,o,a,i){var d=x,e=Math.round(16*e),r=Math.round(16*r),o=Math.round(16*o),t=Math.round(16*t),s=e-r,u=(n=Math.round(16*n))-t,c=r-o,f=(a=Math.round(16*a))-n,h=o-e,g=t-a,y=Math.max(Math.min(e,r,o)+15>>4,0),l=Math.min(Math.max(e,r,o)+15>>4,x),p=Math.max(Math.min(t,n,a)+15>>4,0),m=Math.min(Math.max(t,n,a)+15>>4,v);y&=-8,p&=-8;var M=-u*e-s*t,w=-f*r-c*n,T=-g*o-h*a;(u>0||0==u&&s>0)&&M++,(f>0||0==f&&c>0)&&w++,(g>0||0==g&&h>0)&&T++,M=M-1>>4,w=w-1>>4,T=T-1>>4;var S=0,A=0,C=0,K=0,L=0,O=0;s>=0?A-=7*s:S-=7*s,u>=0?A-=7*u:S-=7*u,c>=0?K-=7*c:C-=7*c,f>=0?K-=7*f:C-=7*f,h>=0?O-=7*h:L-=7*h,g>=0?O-=7*g:L-=7*g;for(var _=d-8,b=p;b<m;b+=8)for(var D=y;D<l;D+=8){var I=M+s*b+u*D,P=w+c*b+f*D,B=T+h*b+g*D;if(!(I<A||P<K||B<O)){var R=D+b*d;if(I>=S&&P>=C&&B>=L)for(U=0;U<8;U++){for(N=0;N<8;N++,R++)E[renderTarget+R]=i;R+=_}else for(var U=0;U<8;U++){for(var k=I,F=P,G=B,N=0;N<8;N++)(k|F|G)>=0&&(E[renderTarget+R]=i),k+=u,F+=f,G+=g,R++;I+=s,P+=c,B+=h,R+=_}}}}function c(e=0,t=0,r=16,n=16,o=0,a=0,i=!1,d=!1){for(var s=0;s<n;s++)for(var u=0;u<r;u++)a+s<v&&o+u<x&&a+s>-1&&o+u>-1&&(i&d?E[renderSource+((t+(n-s))*x+e+(r-u))]>0&&(E[renderTarget+((a+s)*x+o+u)]=pal[E[renderSource+((t+(n-s))*x+e+(r-u))]]):d&&!i?E[renderSource+((t+(n-s))*x+e+u)]>0&&(E[renderTarget+((a+s)*x+o+u)]=E[renderSource+((t+(n-s))*x+e+u)]):i&&!d?E[renderSource+((t+s)*x+e+(r-u))]>0&&(E[renderTarget+((a+s)*x+o+u)]=E[renderSource+((t+s)*x+e+(r-u))]):i||d||E[renderSource+((t+s)*x+e+u)]>0&&(E[renderTarget+((a+s)*x+o+u)]=pal[E[renderSource+((t+s)*x+e+u)]]))}function f(e=0,t=0,r=16,n=16,o=0,a=0,i=16,d=16,s=!1,u=!1){for(var c=r/i,f=n/d,h=0;h<d;h++)for(var g=0;g<i;g++)px=g*c|0,py=h*f|0,a+h<v&&o+g<x&&a+h>-1&&o+g>-1&&E[renderSource+((t+py)*x+e+px)]>0&&(E[renderTarget+((a+h)*x+o+g)]=E[renderSource+((t+py)*x+e+px)])}function h(e,t,r,n,o,a,i,d){d*=.0174533;var s=e+r/2,u=t+n/2,c=r*i/2*1.41421356237|5,f=n*i/2*1.41421356237|5,h=-c,g=c,y=-f,l=f,p=1/i,v=Math.cos(-d)*p,m=Math.sin(-d)*p;for(let e=y;e<l;e++)for(let t=h;t<g;t++){let i=s+Math.round(v*t+m*e),d=u+Math.round(-m*t+v*e),c=t+o|0,f=e+a|0;i>=0&&d>=0&&i<r&&d<n&&E[renderSource+(d*x+i)]>0&&(E[renderTarget+(f*x+c)]=E[renderSource+(d*x+i)])}}function g(){for(var e=131072;e--;)S[e]=colors[pal[E[e]]];M.data.set(T),ctx.putImageData(M,0,0)}function y(e){for(var t=e[0].length,n=0;n<t;n++){var o=[];o=p(e[0].charAt(n));for(var a=0;a<5;a++)for(var i=0;i<5;i++)1==o[5*a+i]&&(1==e[4]?r(e[1]+i*e[4]+(5*e[4]+e[3])*n,e[2]+a*e[4],e[5]):d(e[1]+i*e[4]+(5*e[4]+e[3])*n,e[2]+a*e[4],e[4],e[4],e[5]))}}function l(e){var t=5*e[7],r=e[0].split("\n"),n=r.slice(0),o=r.length,a=n.sort(function(e,t){return t.length-e.length})[0],i=a.length*t+(a.length-1)*e[3],d=o*t+(o-1)*e[4];e[5]||(e[5]="left"),e[6]||(e[6]="bottom");var s=e[1],u=e[2],c=e[1]+i,f=e[2]+d;"center"==e[5]?(s=e[1]-i/2,c=e[1]+i/2):"right"==e[5]&&(s=e[1]-i,c=e[1]),"center"==e[6]?(u=e[2]-d/2,f=e[2]+d/2):"bottom"==e[6]&&(u=e[2]-d,f=e[2]);for(var h=s+i/2,g=u+d/2,l=0;l<o;l++){var p=r[l],x=p.length*t+(p.length-1)*e[3],v=e[1],m=e[2]+(t+e[4])*l;"center"==e[5]?v=e[1]-x/2:"right"==e[5]&&(v=e[1]-x),"center"==e[6]?m-=d/2:"bottom"==e[6]&&(m-=d),y([p,v,m,e[3]||0,e[7]||1,e[8]])}return{sx:s,sy:u,cx:h,cy:g,ex:c,ey:f,width:i,height:d}}function p(e){return index=fontString.indexOf(e),fontBitmap.substring(25*index,25*index+25).split("")}const x=512,v=256;var m=document.getElementById("canvas");ctx=m.getContext("2d"),renderTarget=0,renderSource=131072,colors=[4278190080,4281606178,4282132549,4281416038,4282078863,4280709599,4284915929,4288332782,4281791227,4283491737,4281384554,4285436983,4281297227,4280568658,4281941042,4285808447,4286734384,4292963931,4294941539,4293184863,4294761419,4294967295,4290227611,4287069828,4285164137,4283586137,4287251062,4281479852,4284700633,4290411479,4283078543,4281364362],palDefault=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],pal=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],ctx.imageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,m.width=x,m.height=v;var M=ctx.getImageData(0,0,x,v),w=new ArrayBuffer(M.data.length),T=new Uint8Array(w),S=new Uint32Array(w),E=new Uint8ClampedArray(x*v*8);states={},init=(()=>{last=0;dt=0;now=0;t=0;moveX=0;speedFactor=.6;songTrigger=!1;state="menu";demostate=0;audioCtx=new AudioContext;fontString="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890_!@.'\"?/<()";fontBitmap="11111100011111110001100011111010001111101000111110111111000010000100000111111100100101000110001111101111110000111001000011111111111000011100100001000011111100001011110001111111000110001111111000110001111110010000100001001111111111000100001010010111101000110010111001001010001100001000010000100001111110001110111010110001100011000111001101011001110001011101000110001100010111011110100011001011100100000111010001100011001001111111101000111110100011000101111100000111000001111101111100100001000010000100100011000110001100010111010001100011000101010001001000110001101011010101110100010101000100010101000110001010100010000100001001111100010001000100011111001000110000100001000111001110100010001000100111111111000001001100000111110100101001011111000100001011111100001111000001111100111110000111101000101110111110000100010001000010001110100010111010001011100111010001011110000101110011101000110001100010111000000000000000000000111110010000100001000000000100111111000110111101011011101010111110101011111010100000000000000000000000100001100001000100000000000011011010011001000000000000111010001001100000000100000010001000100010001000000010001000100000100000100001000100001000010000010";sounds={};loop()}),stopCapture=(e=>{}),window.addEventListener("keyup",function(e){Key.onKeyup(e)},!1),window.addEventListener("mousedown",function(e){stopCapture(e)},!1),window.addEventListener("keydown",function(e){Key.onKeydown(e)},!1),window.addEventListener("blur",function(e){paused=!0},!1),window.addEventListener("focus",function(e){paused=!1},!1),loop=(()=>{let e=(new Date).getTime();dt=Math.min(1,(e-last)/1e3);t+=dt;states[state].render();states[state].step(dt);last=e;g();requestAnimationFrame(loop)}),states.gameover={step:function(e){Key.isDown(Key.r)&&(state="menu")},render:function(r){renderTarget=0,e(0),l(["GAME OVER",256,80+15*Math.sin(2.5*t),8+4*Math.cos(2.9*t),15+5*Math.sin(3.5*t),"center","top",9,27])}},states.menu={step:function(e){Key.isDown(Key.p)&&(state="game")},render:function(n){renderTarget=0,e(0);let o=t/3;for(let e=-128;e<128;e+=1)for(let t=-256;t<256;t+=2)r(256+t+256*Math.cos(4*(e/128+o))+e,256+e+128*Math.sin(4*(t/256+o))+t,t/8%32);l(["PROTOGAME",256,40+15*Math.sin(2.5*t),8+4*Math.cos(2.9*t),15+5*Math.sin(3.5*t),"center","top",9,21]),l(["PRESS P TO CONTINUE",256,230,2,2,"center","top",1,21])}},states.game={step(e){},render(g){renderTarget=0,e(1);let y=t/3;for(let e=-128;e<128;e+=1)for(let t=-256;t<256;t+=2)r(256+t+256*Math.cos(4*(e/128+y))+e,256+e+128*Math.sin(4*(t/256+y))+t,t/8%32);renderTarget=0,d(0,0,16,16,17),i(400,16,16,16),a(32,32,8,21),o(64,32,8,21),n(128,32,192,64,21),s(0,0,16,16,32,32),u(32,0,64,64,128,128,21),c(0,0,16,16),f(0,0,16,16,0,0,16,16),renderSource=0,h(0,128,128,256,400,128,1.5,45),l(["JS13K BOILERPLATE",256,20,2,2,"center","top",1,21])}},Key={_pressed:{},_released:{},LEFT:37,UP:38,RIGHT:39,DOWN:40,SPACE:32,a:65,w:87,s:83,d:68,z:90,x:88,f:70,p:80,r:82,isDown(e){return this._pressed[e]},justReleased(e){return this._released[e]},onKeydown(e){this._pressed[e.keyCode]=!0},onKeyup(e){this._released[e.keyCode]=!0,delete this._pressed[e.keyCode]},update(){this._released={}}},window.onload=init()}();
</script></body></html>